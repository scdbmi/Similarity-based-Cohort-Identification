This folder contains all queries to be used for data extraction from OMOP compliant data tables. The queries are written in Microsoft SQL Server Management Studio. The queries  should be used to extract patient data for the set of m seed patients and the random sample of n unknown test patients from the EHR. 

The list of n unknown test patients can be generated using the query "GenerateRandomtestpatientlist.sql" or the user can use a list of test patients that they already have. These n unknown test patients should be mutually exclusive with the set of seed patients, i.e. there should not be any overlapping patients between the seed patient set and the random sample set. We used n=30,000 in our experiments. But a smaller number such as n=1000 can be used for inital experiments. This number can be changed in the annotated line in the "GenerateRandomtestpatientlist.sql" query according to what is chosen by the user.

Following this, the set of queries in either the "OMOP based" or the "Source Concept ID based" folder should be used to extract the data. The set of queries in "OMOP based" sub-folder should be used if the user is confident that the OMOP concept IDs are properly populated in the user's database. In case the OMOP concept IDs are not properly populated in all the data tables, the set of queries in "Source Concept ID based" folder should be used. These two folders contain analogous queries for extracting patient conditions, demographics, drugs, labs, and procedures using either the OMOP concept IDs (in the "OMOP based" folder) or the source concept IDs ("Source Concept ID based" folder). In each query, the list of MRNS for the m seed patients and the list of n unknown test patients need to be provided by the user. After execution of each query, the extracted data should be stored in .csv files in the "Modeling" sub-folder. Detailed description of each query and the nomenclature to be used for saving the .csv files is provided next.

OMOP based: This sub-folder contains SQL queries to extract conditions, demographics, drugs, labs, and procedures for the m seed patients and the n test patients from the EHR, by using the OMOP concept IDs for each data type. Before running each query, the list of MRNs for the m seed patients and the list of MRNs for the n unknown test patients need to added in the annotated section of the query.

(i) "Extractconditions_randomsample_OMOPIDs.sql" and (ii) "Extractconditions_seedpatients_OMOPIDs.sql" extracts the conditions for the test patients and the seed patients respectively. 
(iii) "Extractdemo_randomsample_OMOPIDs.sql" and (iv) "Extractdemo_seedpatients_OMOPIDs.sql" extracts the demographics (year and month of birth, and gender) for the test patients and the seed patients respectively. 
(v) "Extractdrugs_randomsample_OMOPIDs.sql" and (vi) "Extractdrugs_seedpatients_OMOPIDs.sql" extracts the drugs/medications for the test patients and the seed patients respectively.
(vii) "Extractlabs_randomsample_OMOPIDs.sql" and (viii) "Extractlabs_seedpatients_OMOPIDs.sql" extracts the laboratory results for the test patients and the seed patients respectively.
(ix) "Extractproc_randomsample_OMOPIDs.sql" and (x) "Extractproc_seedpatients_OMOPIDs.sql" extracts the procedures for the test patients and the seed patients respectively.

Source Concept ID based: This sub-folder contains SQL queries to extract conditions, demographics, drugs, labs, and procedures for the seed patients and the random sample from the EHR, by using the source concept IDs for each data type. This is because often the mappings from the source concept IDs to the OMOP concept IDs may be missing for several source concept IDs due to errors in the ETL process of a database. Thus, if the user's site has incomplete OMOP mappings, then the queires in this folder should be used instead. Before running each query, the list of MRNs for the m seed patients and the n test patients need to added in the annotated section of the query. This sub-folder is organized in exactly the same manner as the "OMOP based" sub-folder, except for the word "OMOP" being replaced by the word "source" in each query name. 

After running each query, the user needs to save the tables being returned by SQL into .csv files that will be used for the next stage of the cohort identification pipeline, namely, the Modeling phase. To maintain consistency with the code written in MATLAB, the data should be stored in the sub-folder "Modeling" with names that match the names of the files being called by MATLAB. The conditions, demographics, drugs, labs, and procedures should be stored as "Randomsample_cond.csv", "Randomsample_demo.csv", "Randomsample_drugs.csv", "Randomsample_labs.csv", and "Randomsample_proc.csv" respectively for the test patient set. The conditions, demographics, drugs, labs, and procedures should be stored as "Seedpatients_cond.csv", "Seedpatients_demo.csv", "Seedpatients_drugs.csv", "Seedpatients_labs.csv", and "Seedpatiens_proc.csv" respectively for the seed patient set.

If the user’s site doesn’t support labs as part of the OMOP CDM version 5 database, as may be the case for claims based datasets, the queries for the labs should be ignored from each of these lists of queries. 

